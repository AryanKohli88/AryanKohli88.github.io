import{_ as t,s as e,n as s,h as n,x as i,j as o,V as a,I as r,i as l,w as c,b2 as d,C as m,A as h}from"./icon-29bbe755.js";import{W as p,bs as u,k as b,t as f,c as v,fN as C,fO as g,h as y,a as S,bT as w,a9 as _,c3 as k,ak as j,b1 as x,b as T,_ as A,aa as E,l as P,aV as I,eO as L,fP as D,fQ as V,Z as M,c_ as $,fR as O,d as q,fS as B,cq as R,cr as U,S as F,fT as N,fU as z,A as Q,fV as H,fW as J,aK as K,J as W,fX as G,o as X}from"./shell-38e4146f.js";import{o as Z}from"./shreddit-comment-7bcc2e2b.js";import{t as Y}from"./throttle-cde4a556.js";import{d as tt,R as et}from"./shreddit-overflow-report-12713898.js";import{S as st}from"./scroll-blocker-d5971046.js";import{t as nt}from"./comments-68d87864.js";import"./shreddit-spoiler-4c6f1a6b.js";import"./faceplate-render-7c6515b0.js";import"./author-flair-event-handler-5979f3fa.js";import{B as it}from"./base-translator-814142e8.js";import"./translation-feedback-modal-078fc04c.js";import{g as ot}from"./post-c7a2ad6d.js";import"./shreddit-comment-badges-26d72adb.js";import"./mod-notes-opener-68f246b5.js";import{R as at}from"./pdp-comment-search-close-6c977699.js";import{s as rt,S as lt}from"./search-params-4f07870b.js";import{S as ct,a as dt,b as mt}from"./search-dynamic-id-f25c0a6c.js";import"./reddit-feed-baf2fac7.js";import"./faceplate-search-input-a84cac67.js";import"./faceplate-tooltip-8723976a.js";import"./adjust-search-query-link-480a0e91.js";import"./search-dynamic-id-cache-controller-1004a10d.js";import"./translation-contribution-toggle-288049a9.js";import"./rpl-dialog-trigger-6fc96c17.js";import"./rpl-bottom-sheet-d9704438.js";import"./faceplate-number-aa3b71c1.js";import"./locale-e49f0b05.js";import"./number-ea0536b9.js";import"./cached-intl-e5b35306.js";import"./faceplate-timeago-7eb5da18.js";import"./relative-date-77173042.js";import"./mention-node-d2d1a9a8.js";import"./upload-af3134f0.js";import"./upload-to-s3-2da7bd68.js";import"./comment-composer-host-eb95c94b.js";import"./rte-toolbar-button-emote-c1f14026.js";import"./faceplate-dropdown-menu-13cc41dc.js";import"./popper-controller-267df72e.js";import"./makeEventDispatcher-ddce7d90.js";import"./postComposerFields-99c30dc1.js";import"./translations-80aaf823.js";import"./faceplate-checkbox-input-e8cb9934.js";import"./checked-input-element-49c8b895.js";import"./faceplate-input-6da71712.js";import"./input-element-5b4d45e2.js";import"./form-common-utils-52a96849.js";import"./constants-17b30c47.js";import"./faceplate-modal-f4c056ae.js";import"./automation-rule-triggered-rules-04e40739.js";import"./filterNullish-14d2de97.js";import"./avatar-6a32efda.js";import"./rtjson-e5eac1b0.js";import"./dom-37d48515.js";import"./reputation-recaptcha-412654c1.js";import"./comment-b3876d6b.js";import"./modActions-112bd6f6.js";import"./sleep-a1fd43c3.js";import"./faceplate-progress-616641b8.js";import"./telemetry-event-struct-fef69997.js";import"./outbound-link-tracking-controller-13b8ddb2.js";import"./classnameUtils-e77f7123.js";import"./common-ui-strings-4cfeaa7e.js";import"./faceplate-textarea-input-02098dd3.js";import"./live-13af0347.js";import"./text-input-b548c0bb.js";import"./icon-checkmark-87dbeb55.js";import"./faceplate-bottom-sheet-49557042.js";import"./TinyGesture-32f2fddd.js";import"./post-69fe4f77.js";import"./distinguished-tags-02527156.js";import"./mod-notes-6691414f.js";import"./faceplate-text-input-ec8f6ffc.js";import"./faceplate-switch-input-1f1cd955.js";import"./TinyGesture-6f7cc1aa.js";const ht=p(e);let pt=class extends ht{constructor(){super(...arguments),this.commentId="",this.parentCommentPermalink="",this.postPermalink="",this.isInModQueue=!1,this.onLinkClick=(t,e)=>{this.isInModQueue&&(t.stopPropagation(),t.preventDefault(),u?.(b.ModQueuePdpLinkClick,{isFullDiscussionLink:e,parentCommentPermalink:this.parentCommentPermalink,postPermalink:this.postPermalink}))}}static get styles(){return[f,v(".single-comment-thread-toolbar {\n  align-items: center;\n  display: flex;\n  flex-flow: row nowrap;\n  font: var(--font-title-h6);\n  justify-content: space-between;\n  padding: 0.5rem 1rem;\n}\n")]}firstUpdated(){this.updateComplete.then((()=>{if(this.isInModQueue)return;const t=this.getBoundingClientRect().top;window.scrollTo({top:t-48,behavior:"auto"})}))}handleSeeFullDiscussionLink(t){this.onLinkClick(t,!0);const e=document.querySelector("shreddit-post");e&&this.trackEvent(C(e))}render(){if(!this.commentId)return;const t=this.isInModQueue?"View parent comment":"Single comment thread",e="no-underline hover:no-underline visited:no-underline text-primary";return i`\n <div>\n <div class="single-comment-thread-toolbar text-neutral-content-weak">\n ${this.parentCommentPermalink?i`\n <a \n href="${this.parentCommentPermalink}" \n class="${e}" \n @click="${this.onLinkClick}" \n>\n ${t}\n </a>\n `:i` <span>${t}</span> `}\n <span class="flex-1 h-px mx-xs bg-tone-4" data-id="line"></span>\n <a \n href="${this.postPermalink}" \n class="${e}" \n @click="${this.handleSeeFullDiscussionLink}" \n>\n See full discussion\n </a>\n </div>\n </div>\n `}};t([s({type:String,attribute:"comment-id"})],pt.prototype,"commentId",void 0),t([s({type:String,attribute:"parent-comment-permalink"})],pt.prototype,"parentCommentPermalink",void 0),t([s({type:String,attribute:"post-permalink"})],pt.prototype,"postPermalink",void 0),t([s({type:Boolean,attribute:"is-in-modqueue"})],pt.prototype,"isInModQueue",void 0),pt=t([n("shreddit-comments-page-tools")],pt);const ut=p(S(e));let bt=class extends ut{constructor(){super(...arguments),this.thingId="",this.postId="",this.subredditPrefixedName="",this.isTruncated=!1,this.totalComments=0,this.isProfilePost=!1,this.isReportingEnabled=!1,this.ui="mobile",this.shouldTrackCommentsTelemetry=!1,this.permalink="",this.author="",this.isAuthorDeleted=!1,this.pageUnloaded=!1,this.initialViewStats={num_comments_viewed:0,comments_viewed_json:[],comments_viewed_list:[],num_comments_consumed:0,comments_consumed_json:[],comments_consumed_list:[]},this.view_stats=this.cloneObject(this.initialViewStats),this.correlation_id=w(),this.overflowActionsMenuRef=_(),this.scrollBlocker=new st(this),this._visibilityDetails=null,this.depthUpdated=null,this.handleVisibilityChange=t=>{t?(this.pageUnloaded=!1,this.resetViewStats()):this.pageUnloaded||this.flushEvents()},this.onBeforeUnload=()=>{this.pageUnloaded=!0,this.flushEvents()},this.flushEvents=()=>{const t=((t,e,s,n,i)=>{let o={};const a=g("post"),r=e.slice(0,1e3);return o={correlation_id:i,view_stats:{num_comments_viewed:t,comments_viewed_json:JSON.stringify(r),comments_viewed_list:s},post:{...a,number_comments:n}},y({source:"post",action:"view",noun:"comments"},o)})(this.view_stats.num_comments_viewed,this.view_stats.comments_viewed_json,this.view_stats.comments_viewed_list,this.totalComments,this.correlation_id),e=((t,e,s,n,i)=>{let o={};const a=g("post"),r=e.slice(0,1e3);return o={correlation_id:i,view_stats:{num_comments_consumed:t,comments_consumed_json:JSON.stringify(r),comments_consumed_list:s},post:{...a,number_comments:n},screen:{height:window?.screen.height,width:window?.screen.width}},y({source:"post",action:"consume",noun:"comments"},o)})(this.view_stats.num_comments_consumed,this.view_stats.comments_consumed_json,this.view_stats.comments_consumed_list,this.totalComments,this.correlation_id);this.trackEvent(t),this.trackEvent(e),this.resetViewStats()},this.commentsViewedListener=t=>{this.updateCommentsViewedStats(t.detail)},this.commentsConsumedListener=t=>{this.updateCommentsConsumedStats(t.detail)},this.handleCloseOverflowActionsMenu=()=>{this.overflowActionsMenuRef.value?.close(),document.documentElement.removeEventListener("click",this.handleCloseOverflowActionsMenu),this.scrollBlocker.unblockPageScrolling()},this.handleCommentCreated=({parentThingId:t,body:e})=>{this.postId===t&&e&&(this.querySelector("#next-comment")?.after(...k(e)),this.totalComments+=1)}}static get styles(){return[f,v(":host {\n  display: block;\n  background-color: var(--shreddit-content-background);\n  padding-bottom: var(--spacer-xs);\n}\n"),v(tt)]}get visibilityDetails(){return null===this._visibilityDetails&&null===this.depthUpdated&&(this.depthUpdated=new Promise((t=>{requestAnimationFrame((()=>{const e=this.getVisibilityDetails();this._visibilityDetails=e,t(e)}))}))),this._visibilityDetails}getVisibilityDetails({containerWidth:t}={}){const e=this.querySelector(":scope > shreddit-comment")?.depth??0;t??(t=this.getBoundingClientRect().width);const s="mobile"===this.ui?232:320,n="mobile"===this.ui?18:32,i="mobile"===this.ui?4:10,o=Math.floor((t-s)/n),a=Math.max(1,Math.min(o,i)),r=a+e,l=this.querySelector(":scope shreddit-comment[is-chosen-mq-comment]"),c=l?.depth??0,d=Math.max(e,c-a+1);return l?{maxVisibleDepth:d+a,minVisibleDepth:d}:{maxVisibleDepth:r}}cloneObject(t){return JSON.parse(JSON.stringify(t))}connectedCallback(){super.connectedCallback(),this.addEventListener(Z,this.handleOpenOverflowActionsMenu),this.subscribe(b.CommentCreated,this.handleCommentCreated),this.resizeObserver=new ResizeObserver(Y((t=>{let e=0;for(const s of t){const t=s.contentBoxSize.at(0)?.inlineSize;if(t){e=t;break}}if(0===e)return;const s=this.getVisibilityDetails({containerWidth:e});if(this._visibilityDetails?.maxVisibleDepth!==s.maxVisibleDepth||this._visibilityDetails?.minVisibleDepth!==s.minVisibleDepth){this._visibilityDetails=s,this.depthUpdated=Promise.resolve(s);for(const t of this.querySelectorAll("shreddit-comment"))t.setVisibility(s.maxVisibleDepth,s.minVisibleDepth)}}),128,!0)),this.resizeObserver.observe(this,{box:"content-box"}),this.shouldTrackCommentsTelemetry&&(this.addEventListener("comments-viewed-event",this.commentsViewedListener),this.addEventListener("comments-consumed-event",this.commentsConsumedListener),j.subscribe(this.onBeforeUnload,{unloadOnly:!0}),x(this.handleVisibilityChange,{immediate:!0}),window.addEventListener("beforeRoute",(()=>{this.flushEvents()})))}resetViewStats(){this.correlation_id=w(),this.view_stats=this.cloneObject(this.initialViewStats)}updateCommentsViewedStats(t){return this.view_stats.comments_viewed_json.find((e=>e.comment_id===t?.detail.comment_id))||(this.view_stats.comments_viewed_json.push({comment_depth:t?.detail.comment_depth,comment_id:t?.detail.comment_id,comment_parent_id:t?.detail.comment_parent_id}),this.view_stats.comments_viewed_list.push(t?.detail.comment_id),this.view_stats.num_comments_viewed=this.view_stats.comments_viewed_json.length),t}updateCommentsConsumedStats(t){return this.view_stats.comments_consumed_json.find((e=>e.comment_id===t?.detail.comment_id))||(this.view_stats.comments_consumed_json.push({comment_depth:t?.detail.comment_depth,comment_id:t?.detail.comment_id,comment_parent_id:t?.detail.comment_parent_id}),this.view_stats.comments_consumed_list.push(t?.detail.comment_id),this.view_stats.num_comments_consumed=this.view_stats.comments_consumed_json.length),t}disconnectedCallback(){super.disconnectedCallback(),j.unsubscribe(this.onBeforeUnload),this.removeEventListener(Z,this.handleOpenOverflowActionsMenu),this.unsubscribe(b.CommentCreated,this.handleCommentCreated),this.resizeObserver?.unobserve(this),this.resizeObserver?.disconnect(),this.removeEventListener("comments-viewed-event",this.commentsViewedListener),this.removeEventListener("comments-consumed-event",this.commentsConsumedListener)}showAllComments(){this.isTruncated=!1,this.trackEvent(nt())}renderShredtopViewMoreCommentsButton(t){return T({attributes:{type:"button",className:"ml-sm xs:ml-0 font-semibold mt-md",onclick:t},appearance:"brand",shape:"pill",leadingIcon:a({size:r.Medium}),size:A.Small,children:"View more comments"})}renderTruncatedExpandButton(){return this.renderShredtopViewMoreCommentsButton(this.showAllComments)}renderContent(){return i`\n <section \n class="flex flex-col px-md xs:px-0 gap-md relative" \n aria-label="Comments" \n>\n <slot></slot>\n ${this.isTruncated?"":i`<slot name="truncated"></slot>`}\n </section>\n `}renderExpandButton(){return this.isTruncated?this.renderTruncatedExpandButton():""}render(){return i`\n ${this.renderContent()}\n <faceplate-dialog \n ${E(this.overflowActionsMenuRef)}\n class="overflow-actions-dialog" \n @click="${this.handleCloseOverflowActionsMenu}" \n>\n <faceplate-screen-reader-content id="overflow-actions-menu-label">\n Additional comment actions\n </faceplate-screen-reader-content>\n <ul class="overflow-actions-menu" aria-labelledby="overflow-actions-menu-label">\n <li>\n <a href="${this.permalink}">\n <icon-link-post aria-hidden="true" class="overflow-actions-icon"></icon-link-post>\n Share\n </a>\n </li>\n ${this.isProfilePost?"":i`\n <li>\n <a href="/${this.subredditPrefixedName}/">\n <icon-admin aria-hidden="true" class="overflow-actions-icon"></icon-admin>\n More from ${this.subredditPrefixedName}\n </a>\n </li>\n `}\n ${this.isAuthorDeleted?"":i`<li>\n <a href="/user/${this.author}/">\n <icon-user aria-hidden="true" class="overflow-actions-icon"></icon-user> ${this.author}'s profile\n </a>\n </li>`}\n ${this.isReportingEnabled?i`<li>\n <shreddit-overflow-report \n thingId="${this.thingId}" \n type="${et.COMMENT}" \n></shreddit-overflow-report>\n </li>`:""}\n <button \n class="button button-small button-plain block bg-tone-6 text-tone-3 mt-[10px] mx-auto mb-0 w-[calc(100%-20px)] max-w-full" \n>\n Close\n </button>\n </ul>\n </faceplate-dialog>\n ${this.renderExpandButton()}\n `}handleOpenOverflowActionsMenu({detail:{author:t,isAuthorDeleted:e,permalink:s,thingId:n}}){this.author=t,this.isAuthorDeleted=e,this.permalink=s,this.thingId=n,this.overflowActionsMenuRef.value?.showModal(),document.documentElement.addEventListener("click",this.handleCloseOverflowActionsMenu),this.scrollBlocker.blockPageScrolling()}};t([s({type:String})],bt.prototype,"thingId",void 0),t([s({type:String,attribute:"post-id"})],bt.prototype,"postId",void 0),t([s({type:String,attribute:"subreddit-prefixed-name"})],bt.prototype,"subredditPrefixedName",void 0),t([s({type:Boolean})],bt.prototype,"isTruncated",void 0),t([s({type:Number})],bt.prototype,"totalComments",void 0),t([s({type:Boolean})],bt.prototype,"isProfilePost",void 0),t([s({type:Boolean,attribute:"is-reporting-enabled"})],bt.prototype,"isReportingEnabled",void 0),t([s({type:String,attribute:"ui"})],bt.prototype,"ui",void 0),t([s({type:Boolean,attribute:"should-track-comments-telemetry"})],bt.prototype,"shouldTrackCommentsTelemetry",void 0),t([o()],bt.prototype,"permalink",void 0),t([o()],bt.prototype,"author",void 0),t([o()],bt.prototype,"isAuthorDeleted",void 0),bt=t([n("shreddit-comment-tree")],bt);let ft=class extends e{constructor(){super(),this.postId="",this.handleCommentCreated=({postId:t})=>{t===this.postId&&this.remove()},this.pubsub=new P(this)}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.CommentCreated,this.handleCommentCreated)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.CommentCreated,this.handleCommentCreated)}render(){return i`<slot></slot>`}};ft.styles=[l`:host{display:contents}`,f],t([s({type:String,attribute:"post-id"})],ft.prototype,"postId",void 0),ft=t([n("comment-forest-empty-state")],ft);let vt=class extends it{constructor(){super(...arguments),this.mtSeoLanguage="",this.isSeoVisit=!1,this.isLoadingTranslations=!1,this._partialRequestController=new I(this),this.seoVisitSettled=!1,this.pubsub=new P(this),this.onPostTranslationOverride=t=>{"PDP"===t.pageType&&(t.isTranslationActive?this.onTranslationsEnabled():this.onTranslationsDisabled())}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.I18nPostTranslationOverride,this.onPostTranslationOverride),this.addEventListener(L,this.handleTranslationFeedback)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.I18nPostTranslationOverride,this.onPostTranslationOverride)}updated(t){t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&(this.seoVisitSettled||!this.isSeoVisit?super.onUpdateTranslationContextValue(t):this.seoVisitSettled=!0)}async onTranslationsEnabled(){const t=await this.runTranslations(!0);D(!0),V(!0,this.mtSeoLanguage),this.submitTranslationMetrics(),this.toggleObserverForComments(t.fetchedComments)}async onTranslationsDisabled(){const t=await this.runTranslations(!1);D(!1),V(!1,this.mtSeoLanguage),this.submitTranslationMetrics(),this.toggleObserverForComments(t.fetchedComments)}async runTranslations(t){const e=t??!!this.translationContextValue.isTranslationActive,s=this.getCommentsMetadata();this.storeCommentTranslationCache(s.map((t=>({id:t.id,translation:t.isTranslated?t.slot.innerHTML:void 0,original:t.isTranslated?void 0:t.slot.innerHTML}))));const n=[];this.objectTranslationCache.forEach(((t,s)=>{(e&&!t.translatedElement||!e&&!t.originalElement)&&n.push(s)}));let i=[];return n.length&&(i=await this.fetchComments(n,e?"translated":"original"),this.storeCommentTranslationCache(i||[])),this.renderTranslationCache(e),{fetchedComments:i}}getCommentsMetadata(){const t=this.querySelectorAll("shreddit-comment");return Array.from(t).filter((t=>{const e=t.getAttribute("thingid"),s=null!==t.getAttribute("is-translatable"),n=t.querySelector('div[slot="comment"]');return!!e&&s&&!!n})).map((t=>this.getCommentMetadata(t)))}getCommentMetadata(t){return{id:t.getAttribute("thingid"),isTranslated:null!==t.getAttribute("is-comment-translated"),isTranslatable:null!==t.getAttribute("is-translatable"),element:t,slot:t.querySelector('div[slot="comment"]'),cache:this.objectTranslationCache.get(t.getAttribute("thingid"))}}async fetchComments(t,e){const s=new FormData;t.forEach((t=>s.append("commentIds[]",t))),s.append("includeTranslation","translated"===e?"true":"false"),s.append("includeOriginal","original"===e?"true":"false");const n=await this.fetchRequestPartial("/svc/shreddit/translated-comment/",{method:M.Post,body:s});return n?this.parseFetchCommentResponse(n):[]}parseFetchCommentResponse(t){return t.map((t=>{const e=t.getAttribute("data-comment-id"),s=t.querySelector(`[data-translated-comment-id="${e}"]`)?.querySelector(`#${e}-translated-post-rtjson-content`),n=t.querySelector(`[data-original-comment-id="${e}"]`)?.querySelector(`#${e}-post-rtjson-content`),i=t=>t?`<div class="py-0 xs:mx-xs mx-2xs inline-block">${t}</div>`:void 0;return{id:e,original:i(n?.innerHTML),translation:i(s?.innerHTML)}}))}storeCommentTranslationCache(t){t.forEach((t=>{this.updateTranslationCache(t.id,{originalElement:t.original?{content:t.original}:void 0,translatedElement:t.translation?{content:t.translation}:void 0})}))}renderTranslationCache(t){const e=t??!!this.translationContextValue.isTranslationActive;this.getCommentsMetadata().filter((t=>t.isTranslated!==e&&(e?!!t.cache?.translatedElement:!!t.cache?.originalElement))).forEach((t=>{const s=e?t.cache.translatedElement:t.cache.originalElement;t.slot.innerHTML=s?.content||"",e?t.element.setAttribute("is-comment-translated","true"):t.element.removeAttribute("is-comment-translated")}))}handleTranslationFeedback(t){const{postId:e,commentId:s}=t.detail,n=document.querySelector("shreddit-post"),i=n?.querySelector('[slot="title"]'),o=n?.querySelector('[slot="text-body"]'),a=this.shadowRoot?.getElementById($.ID.PDP_COMMENT_FEEDBACK_MODAL);a&&a.show?.({post:{id:ot(e),title:i?.textContent?.trim(),body_text:o?.textContent?.trim(),translation_state:this.translationContextValue.isTranslationActive},comment:{id:s,post_id:ot(e),translation_state:this.translationContextValue.isTranslationActive}})}toggleObserverForComments(t){t?.forEach((t=>{const e=document.querySelector(`shreddit-comment[thingid="${t.id}"]`);e&&e?.addTranslationToggledObserver?.('div[slot="comment"]')}))}submitTranslationMetrics(){if(!this.reportMetrics)return;const t=this.querySelectorAll("shreddit-comment"),e=this.translationContextValue?.isTranslationActive||!1,s={},n=[];t.length&&Array.from(t).filter((t=>{const s=this.getCommentMetadata(t);if(!t)return;const i=s.slot.textContent||"",o=s.cache;let a=e?"":i,r=e?i:"";o&&(a=o.originalElement?.content||a,r=o.translatedElement?.content||r),n.push({id:s.id,originalBody:a,translatedBody:r,isTranslated:s.isTranslated,isTranslatable:s.isTranslatable})})),s.scenario=this.metricsScenario,s.comments=O(e,n),this.dispatchEvent(q(B,s))}render(){return i`\n <div><slot></slot></div>\n <translation-feedback-modal \n id="${$.ID.PDP_COMMENT_FEEDBACK_MODAL}" \n></translation-feedback-modal>\n `}};t([s({type:String,attribute:"mt-seo-language"})],vt.prototype,"mtSeoLanguage",void 0),t([s({type:Boolean,attribute:"is-seo-visit"})],vt.prototype,"isSeoVisit",void 0),vt=t([n("comment-translator")],vt);let Ct=class extends e{constructor(){super(),this.target="",this.path="",this.replaceComments=async({sort:t="",filter:e=""})=>{t!==this.getCurrentSort()&&this.updateLocation({sort:t});const s=new URL(`${location.origin}${this.path}`);t&&s.searchParams.set("sort",t.toLowerCase()),e&&s.searchParams.set("filter",e.toLowerCase()),s.searchParams.set("inline-refresh","true");const n=s.toString().substring(location.origin.length);this.replaceContentController.loadAndReplaceContent({src:n,target:this.target,afterSuccess:()=>R(this,{message:"The comments are sorted successfully",options:{priority:U.assertive}}),afterFailure:()=>this.dispatchEvent(q("faceplate-alert",{level:F.error,message:"Failed to load the comments."}))})},this.handleCommentFilterUpdated=({sort:t,filter:e})=>{this.replaceComments({filter:e??this.getCurrentFilter(),sort:t??this.getCurrentSort()})},this.handleSortEvent=async t=>{this.replaceComments({sort:t.detail.selected?.toLowerCase(),filter:this.getCurrentFilter()})},this.handleClickEvent=async t=>{const e=t.target?.getAttribute("value");e&&(this.replaceComments({filter:e,sort:this.getCurrentSort()}),t.preventDefault())},this.replaceContentController=new at,this.pubsub=new P(this)}updateLocation({sort:t}){const e=new URL(location.href);e.searchParams.set("sort",t.toLowerCase()),history.replaceState({},"",e.toString())}getCurrentFilter(){return this.querySelector("[faceplate-tab-selected]")?.getAttribute("value")?.toLowerCase()||""}getCurrentSort(){return new URLSearchParams(location.search).get("sort")||""}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.CommentFilterUpdated,this.handleCommentFilterUpdated),this.querySelector("shreddit-sort-dropdown")?.addEventListener("comment-sort",this.handleSortEvent),this.querySelector("faceplate-tabgroup")?.addEventListener("click",this.handleClickEvent)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.CommentFilterUpdated,this.handleCommentFilterUpdated),this.querySelector("shreddit-sort-dropdown")?.removeEventListener("comment-sort",this.handleSortEvent),this.querySelector("faceplate-tabgroup")?.removeEventListener("click",this.handleClickEvent)}render(){return i`<slot></slot>`}};t([s({type:String})],Ct.prototype,"target",void 0),t([s({type:String})],Ct.prototype,"path",void 0),Ct=t([n("shreddit-comments-sort-dropdown")],Ct);let gt=class extends e{constructor(){super(...arguments),this.target="",this.path="",this.showOnLoad=!1,this.initialValue="",this.commentComposerSelector=N.commentComposerHost,this.addCommentButton=N.addCommentButton,this.pdpCommentsSortSelector=N.pdpCommentsTreeSortContainer,this.pdpAmaCommentTabSelector=N.pdpAmaCommentTabWrapper,this.shredditCommentsSortSelector=N.shredditCommentsSortDropdown,this.open=this.showOnLoad,this.commentSearchActive=this.showOnLoad,this.focusSearchInput=()=>{this.open||(this.open=!0),this.searchInput?.innerInput?.focus()},this.resetSearchInput=()=>{this.handleClear(),this.open=!1,ct.update(z.PdpCommentSearch),this.commentSearchActive=!1,this.expandSearchButton?.focus()},this.replaceContentController=new at,this.handlePdpCommentSearch=Q((async()=>{const t=this.searchInput?.value??"";if(t){this.commentSearchActive=!0;const e={conversationId:dt.get(z.PdpCommentSearch),impressionId:ct.getUUID(),query:t,scope:{type:H.PDP,path:this.path},cursor:{},type:J.Comments};this.addSearchParamsToUrl(e);const s=new URLSearchParams({...rt(e)});K(this,y({source:"search",action:"click",noun:"full_search_button"},this.searchTelemetryData));const n=document.createElement("span");n.id=this.target,this.replaceContentController.loadAndReplaceContent({src:`/svc/shreddit${this.path}pdp-comment-search-results?${s.toString()}`,target:this.target,wrapPartialElement:t=>(n.appendChild(t),n)})}}),300),this.handleKeyDown=t=>{ct.update(z.PdpCommentSearch),"Enter"===t.key&&t.target===this.searchInput&&this.handlePdpCommentSearch(),"Escape"===t.key&&t.target===this.searchInput&&(t.stopPropagation(),this.commentSearchActive?this.searchInput?.blur():this.resetSearchInput())},this.handleClear=()=>{this.searchInput?.value&&(this.searchInput.value="")}}hideElementsVisibility(t){document.querySelector(this.commentComposerSelector)?.classList.toggle("hidden",t),document.querySelector(this.addCommentButton)?.classList.toggle("hidden",t),document.querySelector(this.pdpCommentsSortSelector)?.classList.toggle("hidden",t),document.querySelector(this.pdpAmaCommentTabSelector)?.classList.toggle("hidden",t),document.querySelector(this.shredditCommentsSortSelector)?.classList.toggle("flex",!t)}connectedCallback(){super.connectedCallback(),this.commentSearchActive=this.showOnLoad,this.open=this.showOnLoad,this.hideElementsVisibility(this.showOnLoad)}get searchTelemetryData(){const t=this.searchInput?.value??"";return{action_info:{page_type:W.PostDetail},search:{conversation_id:dt.get(z.PdpCommentSearch),impression_id:ct.get(z.PdpCommentSearch),query:t,query_id:mt.get({query:t,scope:{type:H.PDP,path:this.path},type:J.Comments},z.PdpCommentSearch),origin_element:G.CommentSearchBar,origin_page_type:W.PostDetail}}}addSearchParamsToUrl(t){const e=location.href,s=new URL(e);s.searchParams.set(lt.Query,t.query),s.searchParams.set(lt.Type,t.type),s.searchParams.set(lt.ConversationId,t.conversationId??dt.get(z.PdpCommentSearch)),s.searchParams.set(lt.ImpressionId,t.impressionId??ct.getUUID());const n=s.toString();n!==e&&history.replaceState({},"",n)}updated(t){if(t.has("open")){const e=!t.get("open")&&this.open,s=t.get("open")&&!this.open;e?this.focusSearchInput():s&&this.expandSearchButton?.focus()}this.hideElementsVisibility(this.commentSearchActive||this.open)}render(){const t="Search Comments";return i`<div \n class="block ml-xs" \n data-faceplate-tracking-context="${JSON.stringify(this.searchTelemetryData)}" \n>\n <faceplate-tracker source="search" action="click" noun="search_bar">\n ${T({appearance:"bordered",attributes:{"aria-controls":"pdp-comment-search-form","aria-expanded":`${this.open}`,className:"border-neutral-border-weak hover:border-neutral-content-weak text-secondary-weak font-normal "+(this.open?"hidden":""),id:"expand-pdp-comment-search-button",onclick:this.focusSearchInput,type:"button"},children:i`<span class="flex pr-xs">${t}</span>`,leadingIcon:i`<span class="flex pl-xs" \n>${d({size:r.Small})}</span>`,screenReaderContent:"Expand comment search"})}\n </faceplate-tracker>\n <form \n class="flex w-full ${X({hidden:!this.open})}" \n id="pdp-comment-search-form" \n @submit="${this.handlePdpCommentSearch}" \n>\n <faceplate-search-input \n class="text-secondary-plain m-0 rounded-full outline outline-1 outline-neutral-border-weak flex-grow focus:outline-neutral-content-weak" \n placeholder="${t}" \n @keydown="${this.handleKeyDown}" \n @focus="${()=>{this.open=!0}}" \n value="${this.initialValue}" \n>\n ${T({attributes:{id:"search-input-clear-button",slot:"clearIcon",type:"button",onclick:this.handleClear},appearance:"plain",size:A.Small,screenReaderContent:"Clear search",leadingIcon:m({size:r.Small})})}</faceplate-search-input>\n ${T({appearance:"plain",attributes:{className:"ml-xs"+(this.commentSearchActive?" hidden":""),id:"cancel-pdp-comment-search-button",onclick:this.resetSearchInput,type:"button"},children:"Cancel"})}\n </form>\n </div>`}};gt.styles=[f],t([s({type:String})],gt.prototype,"target",void 0),t([s({type:String})],gt.prototype,"path",void 0),t([s({attribute:"show-on-load",type:Boolean})],gt.prototype,"showOnLoad",void 0),t([s({type:String,attribute:"initial-value"})],gt.prototype,"initialValue",void 0),t([s({type:String,attribute:"comment-composer-selector"})],gt.prototype,"commentComposerSelector",void 0),t([s({type:String,attribute:"add-comment-button"})],gt.prototype,"addCommentButton",void 0),t([s({type:String,attribute:"pdp-comments-sort-selector"})],gt.prototype,"pdpCommentsSortSelector",void 0),t([s({type:String,attribute:"pdp-ama-comments-tab-selector"})],gt.prototype,"pdpAmaCommentTabSelector",void 0),t([s({type:String,attribute:"shreddit-comments-sort-dropdown-selector"})],gt.prototype,"shredditCommentsSortSelector",void 0),t([c("#expand-pdp-comment-search-button")],gt.prototype,"expandSearchButton",void 0),t([c("faceplate-search-input")],gt.prototype,"searchInput",void 0),t([o()],gt.prototype,"open",void 0),t([o()],gt.prototype,"commentSearchActive",void 0),gt=t([n("pdp-comment-search-input")],gt);let yt=class extends e{constructor(){super(...arguments),this.commentId="",this.dedupe=!1,this.pubsub=new P(this),this.loadInAd=()=>{if(!this.shadowRoot||this.shadowRoot.childNodes.length>0)return;const t=document.querySelector(`shreddit-comment-tree-ads > template#comment-tree-ad_${this.commentId}`),e=t?.content.querySelector("shreddit-comments-page-ad");t&&e&&this.isNotADuplicate(e)&&(this.shadowRoot.replaceChildren(t.content.cloneNode(!0)),e.hasAttribute("is-blank")||this.removeAttribute("class"))},this.isNotADuplicate=t=>{if(!this.dedupe)return!0;const e=document.querySelector("shreddit-comments-page-ad");return!e||t.id!==e.id}}connectedCallback(){super.connectedCallback(),this.commentId&&(this.loadInAd(),this.pubsub.subscribe(b.CommentTreeAdsLoaded,this.loadInAd))}disconnectedCallback(){this.commentId&&this.pubsub.unsubscribe(b.CommentTreeAdsLoaded,this.loadInAd),super.disconnectedCallback()}render(){return h}};yt.styles=[f],t([s({type:String,attribute:"comment-id"})],yt.prototype,"commentId",void 0),t([s({type:Boolean,attribute:"dedupe"})],yt.prototype,"dedupe",void 0),yt=t([n("shreddit-comment-tree-ad")],yt);
//# sourceMappingURL=comment-forest-client-js-50746389.js.map
