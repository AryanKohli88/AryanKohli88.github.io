import"./shreddit-post-02714599.js";import"./shreddit-post-flair-9d3739b2.js";import"./faceplate-progress-616641b8.js";import"./follow-button-25d718db.js";import"./mod-note-overflow-menu-161cfbc1.js";import{_ as t,j as e,n as s,h as i,x as a,s as o,A as r,ce as n,I as l,cF as d,i as c}from"./icon-29bbe755.js";import{aV as p,d3 as u,d0 as m,c_ as h,aQ as b,c$ as f,c3 as T,d2 as S,Z as C,d7 as g,d as j,d8 as y,d4 as v,t as M,b as A,_ as x,bt as I}from"./shell-38e4146f.js";import{B as k}from"./base-translator-814142e8.js";import"./translation-feedback-modal-078fc04c.js";import"./shreddit-post-translator-f6a5a4df.js";import"./pdp-back-button-9e717aa9.js";import{a as E}from"./ama-859a7489.js";import{p as P}from"./pluralize-b19aff3b.js";import"./faceplate-timeago-7eb5da18.js";import"./faceplate-date-7edf5099.js";import"./locale-e49f0b05.js";import"./faceplate-number-aa3b71c1.js";import"./number-ea0536b9.js";import"./cached-intl-e5b35306.js";import"./index-64cc986f.js";import"./content-action-button-607176e1.js";import"./award-controller-37234f0f.js";import"./award-d2cbc0ed.js";import"./index-e62e400a.js";import"./utils-75a02ea9.js";import"./awardsTelemetryState-3fb708c7.js";import"./faceplate-tooltip-8723976a.js";import"./popper-controller-267df72e.js";import"./makeEventDispatcher-ddce7d90.js";import"./content-tags-205aa849.js";import"./postUpdate-a3d942b6.js";import"./modActions-112bd6f6.js";import"./shreddit-post-share-button-84a31c53.js";import"./list-item-290baf48.js";import"./with-share-8052785d.js";import"./a-9b2aeae6.js";import"./index-6b6f75e3.js";import"./mod-actions-controller-691ac8db.js";import"./custom-event-8a5c1c61.js";import"./add-removal-reason-modal-7802a6ef.js";import"./modActions-b6ac3bac.js";import"./keyed-585a9756.js";import"./faceplate-form-0ead5440.js";import"./form-common-utils-52a96849.js";import"./comment-b3876d6b.js";import"./post-c7a2ad6d.js";import"./post-69fe4f77.js";import"./faceplate-input-6da71712.js";import"./input-element-5b4d45e2.js";import"./dropdownButton-309f6234.js";import"./faceplate-dropdown-menu-13cc41dc.js";import"./faceplate-menu-f85d1ee9.js";import"./faceplate-modal-f4c056ae.js";import"./faceplate-textarea-input-02098dd3.js";import"./live-13af0347.js";import"./text-input-b548c0bb.js";import"./constants-17b30c47.js";import"./icon-checkmark-87dbeb55.js";import"./remove-highlighted-post-9a3317a9.js";import"./utils-147dae00.js";import"./pdp-6efc7815.js";import"./throttle-cde4a556.js";import"./faceplate-shimmer-465c99ff.js";import"./click-card-af8e865e.js";import"./faceplate-hovercard-4b61c288.js";import"./outbound-link-tracking-controller-13b8ddb2.js";import"./promote-post-button-0e4d8cea.js";import"./utils-34fce734.js";import"./events-82e64833.js";import"./overflow-menu-actions-8ed9e6ba.js";import"./shreddit-overflow-report-12713898.js";import"./classnameUtils-e77f7123.js";import"./mod-verdict-fe58380e.js";import"./faceplate-carousel-clone-812cf40e.js";import"./faceplate-pagination-indicator-d59cdf1c.js";import"./TinyGesture-6f7cc1aa.js";import"./index-b5439860.js";import"./translations-80aaf823.js";import"./faceplate-bottom-sheet-49557042.js";import"./TinyGesture-32f2fddd.js";import"./faceplate-banner-6b00f344.js";import"./relative-date-77173042.js";const q={TITLE:"title",TEXT_BODY:"text-body",TRANSLATION_SUFFIX:"-translated",TRANSLATION_ERROR:"#post-translation-error",STILL_IMAGE:`.${v}`,MEDIA_URL:"#media-url",MEDIA_FULLSIZE_URL:"#media-fullsize-url",SRC_SET:"#src-set",ZOOMABLE_IMG:"zoomable-img"};let D=class extends k{constructor(){super(),this.translatorChildrenName="shreddit-post",this.seoVisitSettled=!1,this.isSeoVisit=!1,this.translationState={originalMediaSrcset:"",originalMediaUrl:"",originalMediaFullsizeUrl:"",translatedMediaUrl:"",translatedMediaSrcset:"",translatedMediaFullsizeUrl:""},this._partialRequest=new p(this)}connectedCallback(){super.connectedCallback();const t=this.querySelector(this.translatorChildrenName);t&&this.translationContextValue.isTranslationActive&&t.isPostTranslated&&this.trackEvent(this,u(t,!0)),this.addEventListener(m,this.handleTranslationFeedback)}updated(t){t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&(this.seoVisitSettled||!this.isSeoVisit?super.onUpdateTranslationContextValue(t):this.seoVisitSettled=!0)}handleTranslationFeedback(t){const e=this.translationContextValue.isTranslationActive,s=this.querySelector(this.translatorChildrenName),i=s?.id,a=s?.querySelector(e?'[slot="title-translated"]':'[slot="title"]'),o=s?.querySelector(e?'[slot="text-body-translated"]':'[slot="text-body"]'),r=this.shadowRoot?.getElementById(h.ID.PDP_POST_FEEDBACK_MODAL);r&&r.show?.({post:{id:i,title:a?.textContent?.trim(),body_text:o?.textContent?.trim(),translation_state:e}})}async onTranslationsEnabled(){this.togglePostTranslations(!0),this.submitTranslationMetrics()}async onTranslationsDisabled(){this.togglePostTranslations(!1),this.submitTranslationMetrics()}async togglePostTranslations(t){const e=this.findTranslatablePost(t);if(!e)return this.logError({error:"post not found"});if(e.isTranslationFetched)return this.trackEvent(this,u(e,t)),this.toggleMediaTranslation(t),void(e.isPostTranslated=t);if(!e.isTranslatable&&e.postType!==b.Image)return;const s=await this.loadPostTranslations(e,t);if(!(s&&!1===s.includes?.(f)))return this.logError({error:"api error",metadata:{id:e.id,isTranslationActive:t}});e.isTranslatable&&this.trackEvent(this,u(e,t));const i=T(s);this.appendResponseToPost(e,i),this.storeMediaResponseToCache(i,t),this.toggleMediaTranslation(t)}findTranslatablePost(t){const e=this.querySelector(this.translatorChildrenName);if(!(!e||e.isPostTranslated&&t))return e}async loadPostTranslations(t,e){if(t.isTranslatable||t.postType===b.Image){const s=e?S.GetTranslation:S.GetOriginal,i=new FormData;i.append("postId",t.id),i.append("translationState",s),t.isTranslatable&&i.append("isTranslatable","true");const a="/svc/shreddit/translated-post/";return(await this._partialRequest.request(a,{method:C.Post,body:i}))?.text()}}appendResponseToPost(t,e){if(!t.isTranslatable)return;let s=!1;const i=t.isPostTranslated?[q.TITLE,q.TEXT_BODY]:[`${q.TITLE}${q.TRANSLATION_SUFFIX}`,`${q.TEXT_BODY}${q.TRANSLATION_SUFFIX}`];e.forEach((e=>{const a=e.getAttribute("slot")||"";a.includes(q.TEXT_BODY)&&this.isDevPlatformPost()||i.includes(a)&&!t.querySelector(`[slot="${a}"]`)&&(t.appendChild(e),s=!0)})),s&&(t.isTranslationFetched=!0,this.translationContextValue.isTranslationActive?(t.isPostTranslated=!0,t.isPostBodyTranslated=!0):(t.isPostTranslated=!1,t.isPostBodyTranslated=!1))}storeMediaResponseToCache(t,e){const s=document.querySelector(q.STILL_IMAGE),i=document.querySelector(q.ZOOMABLE_IMG)?.querySelector("img");let a,o,r;t.forEach((t=>{t.id===q.MEDIA_URL.slice(1)&&(a=t.textContent||""),t.id===q.SRC_SET.slice(1)&&(r=t.textContent||""),t.id===q.MEDIA_FULLSIZE_URL.slice(1)&&(o=t.textContent||"")})),a&&r&&(e?(this.translationState.originalMediaUrl=s?.getAttribute("src")||"",this.translationState.originalMediaSrcset=s?.getAttribute("srcset")||"",this.translationState.originalMediaFullsizeUrl=i?.getAttribute("src")||"",this.translationState.translatedMediaUrl=a,this.translationState.translatedMediaSrcset=r,this.translationState.translatedMediaFullsizeUrl=o??""):(this.translationState.originalMediaUrl=a,this.translationState.originalMediaSrcset=r,this.translationState.originalMediaFullsizeUrl=o??"",this.translationState.translatedMediaUrl=s?.getAttribute("src")||"",this.translationState.translatedMediaSrcset=s?.getAttribute("srcset")||"",this.translationState.translatedMediaFullsizeUrl=i?.getAttribute("src")||""))}toggleMediaTranslation(t){if(!this.isMediaCacheStored())return;const e=document.querySelector(q.STILL_IMAGE),s=document.querySelector(q.ZOOMABLE_IMG)?.querySelector("img");t?(e?.setAttribute("src",this.translationState.translatedMediaUrl),e?.setAttribute("srcset",this.translationState.translatedMediaSrcset),s?.setAttribute("src",this.translationState.translatedMediaFullsizeUrl)):(e?.setAttribute("src",this.translationState.originalMediaUrl),e?.setAttribute("srcset",this.translationState.originalMediaSrcset),s?.setAttribute("src",this.translationState.originalMediaFullsizeUrl))}isMediaCacheStored(){return!!this.translationState.translatedMediaUrl&&!!this.translationState.originalMediaUrl}isDevPlatformPost(){return null!==this.querySelector("shreddit-devvit-ui-loader")}submitTranslationMetrics(){if(!this.reportMetrics)return;const t=this.querySelector("shreddit-post");if(!t)return;const{id:e,postType:s="",isPostTranslated:i,isTranslatable:a,isPostBodyTranslated:o}=t,r=this.translationContextValue?.isTranslationActive||!1,n={},l=t.querySelector('[slot="title"')?.textContent||"",d=t.querySelector('[slot="title-translated"')?.textContent||"",c=t.querySelector('[slot="text-body"]')?.textContent||"",p=t.querySelector('[slot="text-body-translated"]')?.textContent||"",u=""!==c||""!==p;n.scenario=this.metricsScenario,n.targetLanguage=t.translationLanguage,n.post=g({postId:e,postType:s,translationSetting:r,originalTitle:l,translatedTitle:d,originalBody:c,translatedBody:p,isTitleTranslated:i,isBodyTranslated:u?o:i,isTranslatable:a}),this.dispatchEvent(j(y,n))}render(){return a`\n <div><slot></slot></div>\n <translation-feedback-modal \n id="${h.ID.PDP_POST_FEEDBACK_MODAL}" \n></translation-feedback-modal>\n `}};t([s({type:Boolean,attribute:"is-seo-visit"})],D.prototype,"isSeoVisit",void 0),t([e()],D.prototype,"translationState",void 0),D=t([i("post-translator")],D);let w=class extends o{constructor(){super(...arguments),this.isSetup=!1,this.hasPrevious=!1,this.hasNext=!1,this.feedData=[],this.currentIndex=-1,this.setup=()=>{const t=Array.from(document.querySelectorAll("[slot=mod-queue-feed] mod-queue-list-item, [slot=mod-queue-feed] shreddit-post, [slot=mod-queue-feed] shreddit-profile-comment")).map((t=>t.getAttribute("comment-id")||t.getAttribute("id"))).filter(Boolean);t.length>0&&(this.feedData=t,this.currentIndex=this.feedData.findIndex((t=>t===this.thingId)),this.hasPrevious=this.currentIndex>0,this.hasNext=this.currentIndex+1<this.feedData.length,this.isSetup=!0)},this.handlePreviousBtnClick=()=>{const t=this.feedData[this.currentIndex-1];document.querySelector(`[slot=mod-queue-feed] mod-queue-list-item[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-post[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-profile-comment[comment-id="${t}"] *`)?.click()},this.handleNextBtnClick=()=>{const t=this.feedData[this.currentIndex+1];document.querySelector(`[slot=mod-queue-feed] mod-queue-list-item[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-post[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-profile-comment[comment-id="${t}"] *`)?.click()}}connectedCallback(){super.connectedCallback(),this.setup()}render(){return this.isSetup?a`<div class="flex">\n ${A({appearance:"plain",attributes:{type:"button","aria-label":"Previous post",disabled:!this.hasPrevious,onclick:this.handlePreviousBtnClick},leadingIcon:n({size:l.Small}),size:x.Small})}\n ${A({appearance:"plain",attributes:{type:"button","data-label":"pdp-post-close","aria-label":"Next post",disabled:!this.hasNext,onclick:this.handleNextBtnClick},leadingIcon:d({size:l.Small}),size:x.Small})}\n </div>`:r}};w.styles=[M],t([s({type:String,attribute:"thing-id"})],w.prototype,"thingId",void 0),t([e()],w.prototype,"isSetup",void 0),t([e()],w.prototype,"hasPrevious",void 0),t([e()],w.prototype,"hasNext",void 0),t([e()],w.prototype,"feedData",void 0),t([e()],w.prototype,"currentIndex",void 0),w=t([i("mod-queue-pdp-pagination-buttons")],w);let _=class extends o{constructor(){super(...arguments),this.isVisible=!1,this.handleScroll=t=>{const e=t.target.scrollTop;this.isVisible=e>60}}connectedCallback(){super.connectedCallback();this.closest('[slot="pdp-panel"]')?.addEventListener("scroll",this.handleScroll)}disconnectedCallback(){super.disconnectedCallback();this.closest('[slot="pdp-panel"]')?.removeEventListener("scroll",this.handleScroll)}render(){return this.isVisible?a`<div \n class="bg-neutral-background z-[2] flex justify-end absolute right-md shadow-md p-2xs rounded-full mt-sm" \n>\n <slot name="pagination"></slot>\n <slot name="close"></slot>\n </div>`:r}};_.styles=[M],t([e()],_.prototype,"isVisible",void 0),_=t([i("mod-queue-pdp-floating-ctas")],_);let L=class extends o{constructor(){super(...arguments),this.isMobile=!1,this.showDurationS=8,this.postId="",this.isPillVisible=!1,this.hostCommentCount=0,this.isAddedTabEvent=!1,this.commentCountSubscriptionController=new I(this),this.onData=t=>{this.isAddedTabEvent||(document.querySelector(`.${E}`)?.addEventListener("click",this.handleAmaCommentTabClick),this.isAddedTabEvent=!0);const e=t.subscribe.data.hostCommentCountChange||0;e<=0||(this.hostCommentCount+=e,this.isPillVisible?clearTimeout(this.currentCountDown):this.isPillVisible=!0,this.currentCountDown=setTimeout((()=>{this.isPillVisible=!1}),1e3*this.showDurationS))},this.scrollToCommentsAndRefreshAnswers=()=>{const t=document.querySelector(`.${E}`)?.offsetTop;if(!t)return;const e=document.querySelector("nav")?.offsetHeight??0;window.scrollTo({top:t-e,behavior:"smooth"});document.querySelector('button[value="answered"]')?.click()},this.onPillClick=()=>{this.isPillVisible=!1,this.hostCommentCount=0,this.currentCountDown&&clearTimeout(this.currentCountDown),this.currentCountDown=void 0,this.scrollToCommentsAndRefreshAnswers()},this.handleAmaCommentTabClick=t=>{const e=t.target?.getAttribute("value"),s=e&&e.toLowerCase();"all"!==s&&"answered"!==s||(this.isPillVisible=!1,this.hostCommentCount=0,this.currentCountDown&&clearTimeout(this.currentCountDown))}}static get styles(){return[c`:host{left:50%;position:fixed;top:calc(var(--shreddit-header-height) + 32px);transform:translateX(-50%);z-index:1001}`,M]}getTitleText(){const t=this.hostCommentCount;return P({count:t,single:`${t} new answer`,many:`${t} new answers`})}connectedCallback(){super.connectedCallback(),this.commentCountSubscriptionController.subscribe({query:{operationName:"SubscribeSubscription",query:"\n          subscription SubscribeSubscription($input: SubscribeInput!) {\n            subscribe(input: $input) {\n              ... on BasicMessage {\n                data {\n                  ... on CommentCountUpdateMessageData {\n                    hostCommentCountChange\n                  }\n                }\n              }\n            }\n          }\n          ",variables:{input:{channel:{teamOwner:"CONTENT_AND_COMMUNITIES",category:"COMMENT_COUNT_UPDATE",postID:this.postId}}}},onData:t=>{t.data&&this.onData(t.data)}})}disconnectedCallback(){super.disconnectedCallback(),document.querySelector(`.${E}`)?.removeEventListener("click",this.handleAmaCommentTabClick)}render(){return this.isPillVisible?A({appearance:"primary",attributes:{onclick:this.onPillClick},children:this.getTitleText(),size:this.isMobile?x.Small:x.Large,role:"button"}):r}};t([s({type:Boolean,attribute:"is-mobile"})],L.prototype,"isMobile",void 0),t([s({type:Number,attribute:"show-duration-in-s"})],L.prototype,"showDurationS",void 0),t([s({type:String,attribute:"post-id"})],L.prototype,"postId",void 0),t([e()],L.prototype,"isPillVisible",void 0),t([e()],L.prototype,"hostCommentCount",void 0),L=t([i("ama-new-comment-pill")],L);
//# sourceMappingURL=pdp-post-client-js-549369bd.js.map
