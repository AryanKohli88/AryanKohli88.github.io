import{x as t,q as e,I as s,_ as a,n as l,j as i,w as o,s as n,h as d}from"./icon-29bbe755.js";import{W as r,E as u,aH as h,fn as c,M as p,S as m,d as v,a4 as b,a5 as f,h as w,b as S,_ as y,t as C}from"./shell-38e4146f.js";import{a as g}from"./settingsLabels-850aff28.js";import{O as x}from"./custom-event-8a5c1c61.js";import"./faceplate-modal-f4c056ae.js";let L=class extends(r(n)){constructor(){super(...arguments),this.isSafetySettingsShredditMigrationEnabled=!1,this.isLoading=!0,this.isSubmittable=!1,this.postId="",this._windowEvents=new u(this,(()=>window)),this.handleOpenModalEvent=this._windowEvents.define(x,(async t=>{this.isSubmittable=!1,this.isLoading=!0,this.showModal(),await this.activateFormContentFeature(t.detail.postId),this.postId=t.detail.postId,this.isLoading=!1}))}get oldPostLevel(){return this.querySelector('[name="old-post-level"]')?.value}get oldIsFilterEnabled(){return"true"===this.querySelector('[name="old-is-filter-enabled"]')?.value}activateFormContentFeature(t){return h({name:c,routeParams:{postId:t},renderMode:p.Contents})}showModal(){this.modal?.showModal()}closeModal(){this.modal?.close()}buildAlert(t){const e=t?m.success:m.error;return this.dispatchEvent(v("faceplate-alert",{level:e,message:g(t)}))}async onSave(){const t=this.querySelector('[name="post-level"][checked]'),e=this.querySelector('[name="is-filter-enabled"]');t?.value&&e?(this.submitRequest(t.value,null!=e.value),this.emitV2Event(t.value,null!=e.value)):(this.buildAlert(!1),this.isSubmittable=!0)}async submitRequest(t,e){try{this.isSubmittable=!1;const s=await this.invokeGQL(t,e);this.inspectResp(s)}catch(t){this.buildAlert(!1),this.isSubmittable=!0}}invokeGQL(t,e){return b({operation:f.UpdatePostLevelCrowdControlSettings,variables:{id:this.postId,level:t,filterIsEnabled:e,shouldIncludeUpdatePostCrowdControlFilter:e!==this.oldIsFilterEnabled,shouldIncludeUpdatePostCrowdControlLevel:t!==this.oldPostLevel}})}inspectResp(t){let e=!1;"updatePostCrowdControlFilter"in t.data&&"updatePostCrowdControlLevel"in t.data?t.data.updatePostCrowdControlFilter?.ok&&t.data.updatePostCrowdControlLevel?.ok&&(e=!0):"updatePostCrowdControlFilter"in t.data?t.data.updatePostCrowdControlFilter?.ok&&(e=!0):"updatePostCrowdControlLevel"in t.data&&t.data.updatePostCrowdControlLevel?.ok&&(e=!0),e?(this.buildAlert(!0),this.closeModal()):(this.buildAlert(!1),this.isSubmittable=!0)}isContentLoading(){return this.isLoading}emitV2Event(t,e){const s=this.querySelector('[name="subreddit-id"]'),a=this.querySelector('[name="subreddit-name"]'),l={id:s?.value||"",name:a?.value||""},i=this.querySelector('[name="author-id"]'),o={id:this.postId,author:{id:i?.value||""}};this.buildAndTrack("crowd_control_individual_post",o,l,{value:t,old_value:`${this.oldPostLevel}`}),this.buildAndTrack("crowd_control_individual_post_filter",o,l,{value:`${e}`,old_value:`${this.oldIsFilterEnabled}`})}buildAndTrack(t,e,s,a){const l=w({source:"post_mod_action_menu",action:"save",noun:t},{post:e,subreddit:s,setting:a});this.trackEvent(l)}handleInput(){this.isSubmittable=!0}render(){return t`\n <faceplate-modal inFocusTrap class="max-w-md w-full">\n <div slot="title">\n ${this.isSafetySettingsShredditMigrationEnabled?"Adjust post crowd control":"Adjust Crowd Control"}\n </div>\n\n <div slot="closeButton">\n ${S({appearance:"secondary",leadingIcon:e({size:s.Small}),size:y.Small,attributes:{type:"button",onclick:this.closeModal}})}\n </div>\n\n ${this.isLoading?t`<div class="w-full">\n <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer>\n <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer>\n <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer>\n <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer>\n <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer>\n <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-2/3 h-lg"></faceplate-shimmer>\n </div>`:t`<slot @input="${this.handleInput}"></slot>`}\n\n <div slot="primaryButton">\n ${S({children:"Save",appearance:"primary",attributes:{type:"submit",onclick:this.onSave,disabled:!this.isSubmittable}})}\n </div>\n\n <div slot="secondaryButton">\n ${S({children:"Cancel",appearance:"plain",attributes:{type:"button",onclick:this.closeModal}})}\n </div>\n </faceplate-modal>\n `}};L.styles=[C],a([l({type:Boolean,attribute:"shreddit-safety-settings-enabled"})],L.prototype,"isSafetySettingsShredditMigrationEnabled",void 0),a([i()],L.prototype,"isLoading",void 0),a([i()],L.prototype,"isSubmittable",void 0),a([i()],L.prototype,"postId",void 0),a([o("faceplate-modal")],L.prototype,"modal",void 0),L=a([d("post-level-crowd-control-modal")],L);
//# sourceMappingURL=post-level-crowd-control-client-js-917ae15e.js.map
