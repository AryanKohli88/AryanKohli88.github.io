import{x as e,q as t,I as s,_ as a,w as i,n as r,s as o,h as n}from"./icon-29bbe755.js";import{h as l,J as d,W as c,v as p,w as u,d as h,S as m,a4 as f,a5 as b,b as y,_ as S,t as w}from"./shell-38e4146f.js";import{l as v,L as g}from"./list-item-290baf48.js";import"./faceplate-bottom-sheet-header-f6176ed0.js";import"./faceplate-bottom-sheet-49557042.js";import"./faceplate-modal-f4c056ae.js";import"./TinyGesture-32f2fddd.js";const T=({actionReason:e,subredditId:t,subredditName:s})=>l({source:"global",action:"view",noun:"screen"},{action_info:{page_type:d.FlairsList,reason:e},subreddit:{id:t,name:s}}),x=({eventType:e,actionReason:t,subredditId:s,subredditName:a,flairId:i,flairText:r})=>l({source:"flair_prompt",action:"submit",noun:"flair"},{action_info:{type:e,reason:t},user_flair:{id:i,title:r},subreddit:{id:s,name:a}});var I,F,k;!function(e){e.Subreddit="community",e.Post="post_detail",e.Leaderboard="leaderboard"}(I||(I={})),function(e){e.Success="success",e.Failure="failure"}(F||(F={})),function(e){e.Emoji="emoji",e.Text="text"}(k||(k={}));const N=/:(.*?):/g;var E;!function(e){e.DEFAULT="team",e.COUNTRY="country"}(E||(E={}));let A=class extends(c(o)){constructor(){super(...arguments),this.isDesktopViewport=!1,this.subredditId="",this.subredditName="",this.username="",this.flairs=[],this.teamType=E.DEFAULT,this.actionReason=I.Subreddit,this.isAlwaysShown=!1,this.TeamTypesCopies={[E.DEFAULT]:"Team selected!",[E.COUNTRY]:"Country selected!"},this.open=()=>{const e={actionReason:this.isAlwaysShown?I.Leaderboard:this.actionReason,subredditId:this.subredditId,subredditName:this.subredditName};if(this.isDesktopViewport?this.modal?.open||(this.modal?.showModal(),this.trackEvent(T(e))):this.bottomSheet?.open||(this.bottomSheet?.showModal(),this.trackEvent(T(e))),p.isAvailable()){const e=JSON.parse(p.getItem(u.TeamFlairSelectionIsShown)||"{}");p.setItem(u.TeamFlairSelectionIsShown,JSON.stringify({...e,[this.subredditId]:!0}))}},this.close=()=>{this.isDesktopViewport?this.modal?.close():this.bottomSheet?.close()}}get flairTemplateRadioBtns(){return document.querySelectorAll('faceplate-radio-input[name="flairTemplateId"]')}firstUpdated(){requestAnimationFrame((()=>{if(p.isAvailable()){const e=JSON.parse(p.getItem(u.TeamFlairSelectionIsShown)||"{}");if(Array.isArray(e)){const t={};if(e.forEach((e=>{t[e]=!0})),p.setItem(u.TeamFlairSelectionIsShown,JSON.stringify({...t})),t[this.subredditId]&&!this.isAlwaysShown)return}if(e[this.subredditId]&&!this.isAlwaysShown)return}this.open()}))}async onFlairSelect(e,t,s){e.preventDefault();const a={actionReason:this.isAlwaysShown?I.Leaderboard:this.actionReason,flairId:t,flairText:s.toString(),subredditId:this.subredditId,subredditName:this.subredditName};try{if((await this.makeUpdateUserFlairRequest(t,s))?.data?.updateUserFlair?.ok){this.dispatchEvent(h("faceplate-alert",{level:m.success,message:this.TeamTypesCopies[this.teamType]})),this.trackEvent(x({...a,eventType:F.Success}));for(const e of this.flairTemplateRadioBtns){e.getAttribute("value")===t&&e.click()}}else this.showErrorMessage(),this.trackEvent(x({...a,eventType:F.Failure}))}catch(e){window.Sentry?.captureError?.(e),this.showErrorMessage(),this.trackEvent(x({...a,eventType:F.Failure}))}this.close()}async makeUpdateUserFlairRequest(e,t){return f({operation:b.UpdateUserFlairAndEnabledStatus,variables:{subredditId:this.subredditId??"",isEnabled:!0,flairTemplateId:e,text:t,shouldUpdateUserFlair:!0,shouldUpdateUserFlairEnabledStatus:!0,username:this.username??""}})}showErrorMessage(){this.dispatchEvent(h("faceplate-alert",{level:m.error,message:"Something went wrong"}))}getTitleText(){return"Who are you cheering for?"}renderCloseButton(){return e`<faceplate-tracker \n source="flair_prompt" \n action="click" \n noun="${d.FlairsList}" \n data-faceplate-tracking-context="${JSON.stringify({action_info:{type:"dismiss"},subreddit:{id:this.subredditId,name:this.subredditName}})}" \n slot="closeButton" \n>\n ${y({appearance:"secondary",leadingIcon:t({size:s.Small}),size:S.Small,attributes:{onclick:this.close,className:"close-button","aria-label":"Close team flair selection modal"}})}</faceplate-tracker>`}renderFlairLabel(t){if(!t.text.match(N)||!t.richtext)return{label:t.text.replace(N,"").trim()};const s=JSON.parse(t.richtext);let a="",i=e``;for(const t of s)t.e===k.Emoji&&t.u&&(i=e` <img \n alt="Custom emoji set by the subreddit moderatos" \n src="${t.u}" \n class="w-md h-md mx-xs" \n>`),t.e===k.Text&&t.t&&(a=t.t);return{label:a,leadingIcon:i}}renderFlairsList(){return e`\n ${this.flairs.map((t=>e`<faceplate-tracker \n source="flair_prompt" \n action="click" \n noun="${d.FlairsList}" \n data-faceplate-tracking-context="${JSON.stringify({action_info:{type:"choose"},subreddit:{id:this.subredditId,name:this.subredditName},user_flair:{id:t.id,title:t.text}})}" \n>${v({...this.renderFlairLabel(t),size:g.Medium,onClick:e=>this.onFlairSelect(e,t.id,t.text),attributes:{className:"w-full text-18","aria-label":`A label for ${t.text}`}})}\n </faceplate-tracker>`))}\n `}renderModal(){return e`<faceplate-modal \n ?shouldContentScroll="${!0}" \n class="z-10 rounded-lg w-[370px] max-h-[600px] s:w-[454px] m:w-[455px]" \n>\n ${this.renderCloseButton()}\n <div slot="title" class="text-18">${this.getTitleText()}</div>\n <div class="flex flex-col justify-center w-full">${this.renderFlairsList()}</div>\n </faceplate-modal>`}renderBottomSheet(){return e`<faceplate-bottom-sheet>\n <faceplate-bottom-sheet-header slot="header" has-divider>\n ${this.getTitleText()}\n <span slot="trailing"> ${this.renderCloseButton()}</span>\n </faceplate-bottom-sheet-header>\n <div class="box-border p-md pb-lg w-full overflow-y-scroll">${this.renderFlairsList()}</div>\n </faceplate-bottom-sheet>`}render(){return this.isDesktopViewport?this.renderModal():this.renderBottomSheet()}};A.styles=[w],a([i("faceplate-modal")],A.prototype,"modal",void 0),a([i("faceplate-bottom-sheet")],A.prototype,"bottomSheet",void 0),a([r({type:Boolean,attribute:"is-desktop-viewport"})],A.prototype,"isDesktopViewport",void 0),a([r({type:String,attribute:"subreddit-id"})],A.prototype,"subredditId",void 0),a([r({type:String,attribute:"subreddit-name"})],A.prototype,"subredditName",void 0),a([r({type:String,attribute:"username"})],A.prototype,"username",void 0),a([r({type:Array,attribute:"flairs"})],A.prototype,"flairs",void 0),a([r({type:String,attribute:"team-type"})],A.prototype,"teamType",void 0),a([r({type:String,attribute:"action-reason"})],A.prototype,"actionReason",void 0),a([r({type:Boolean,attribute:"is-always-shown"})],A.prototype,"isAlwaysShown",void 0),A=a([n("team-flair-selection-modal")],A);
//# sourceMappingURL=team-flair-selection-client-js-6a05a662.js.map
